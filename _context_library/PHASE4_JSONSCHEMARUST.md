# JSON Schema Generation from Rust

This document outlines the creation of a separate Rust package for generating JSON schemas from the core library types to enable schema validation and enhanced editor features in the frontend.

Complete documentation for the entire schema system can be found in `docs/src/schema_system.md`.

## Motivation

To ensure perfect alignment between Rust struct definitions and frontend JSON validation, we need a reliable way to generate formal JSON Schema directly from the Rust types. This will:

1. Provide a single source of truth (the Rust structs)
2. Eliminate manual schema creation and maintenance
3. Ensure validation consistency between frontend and backend
4. Automatically update schemas when Rust models change

## Proposed Solution: `mcp-guardian-schema` Package

Create a dedicated Rust package for schema generation that depends on the core library but keeps schema-specific code separate.

### Package Structure

```
/mcp-guardian-schema/
  Cargo.toml
  src/
    lib.rs                   # Main exports and utility functions
    guard_profile_schema.rs  # Guardian profile schemas
    mcp_server_schema.rs     # MCP server schemas
    server_collection_schema.rs  # Server collection schemas
    utils.rs                 # Helper utilities for schema generation
```

### Dependencies

```toml
[package]
name = "mcp-guardian-schema"
version = "0.1.0"
edition = "2021"

[dependencies]
mcp-guardian-core = { path = "../mcp-guardian-core" }
schemars = { version = "0.8", features = ["derive"] }
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
anyhow = "1.0"
```

### Implementation Approach

1. **Core Type Integration**: Use the `schemars` crate to generate JSON Schema from Rust structs
   - Reference the existing core types without modifying them
   - Implement wrapper types with JsonSchema derive where needed

2. **Schema Generation Functions**: Create functions to output schemas for each entity type

   ```rust
   pub fn generate_guard_profile_schema() -> String {
       let schema = schema_for!(GuardProfile);
       serde_json::to_string_pretty(&schema).unwrap()
   }
   
   pub fn generate_mcp_server_schema() -> String {
       let schema = schema_for!(McpServer);
       serde_json::to_string_pretty(&schema).unwrap()
   }
   
   // Other schema generation functions
   ```

3. **Schema Export Methods**: Add functionality to:
   - Output schemas to files during build process
   - Provide Tauri commands to fetch schemas on demand
   - Generate TypeScript constants for direct frontend use

4. **Schema Versioning**: Add capabilities to:
   - Track schema versions alongside code changes
   - Document compatibility between schemas and core types

## Integration with Monaco Editor

The schemas generated by this package will be used by the Monaco Editor integration:

1. Build process will generate schemas and place them in `/components/json-editor/schemas/`
2. Monaco Editor will use these schemas for validation, autocompletion, and documentation
3. Changes to core types will automatically flow through to updated schemas

## Future Capabilities

1. **Customized Schema Annotations**: Add support for enhanced annotations like:
   - Descriptive documentation for fields
   - UI hints for specific field formatting
   - Validation rules beyond basic type checking

2. **Advanced Validation Rules**: Add cross-field validation and complex condition rules
   - Implement custom validation logic that can't be expressed in plain JSON Schema
   - Add computed property support for derived values

3. **Schema Migration Tools**: Create utilities to help migrate data between schema versions
   - Detect and apply migrations when schema changes
   - Provide backward compatibility layers

## Implementation Tasks

1. **Package Creation**: ‚úÖ
   - ‚úÖ Create initial project structure
   - ‚úÖ Set up dependencies and build configuration
   - ‚úÖ Add workspace integration

2. **Basic Schema Generation**: ‚úÖ
   - ‚úÖ Add JsonSchema derives to core types
   - ‚úÖ Implement schema generation for all core types
   - ‚úÖ Create CLI tool for schema generation
   - ‚úÖ Add schema export functionality
   - ‚úÖ Implement versioning for schemas

3. **Frontend Integration**: üîÑ
   - ‚úÖ Create frontend schema directory
   - ‚úÖ Export schemas to frontend directory
   - ‚úÖ Prepare for Monaco Editor integration
   - ‚ùå Complete Monaco Editor implementation (pending)

4. **Documentation**: ‚úÖ
   - ‚úÖ Document schema generation approach
   - ‚úÖ Create comprehensive schema system documentation
   - ‚úÖ Add usage examples and CLI documentation
   - ‚úÖ Create guidelines for maintaining schema compatibility

This approach provides a clean separation of concerns while ensuring type safety and consistency across the entire application. The implementation has been completed for the schema generation package, with the frontend Monaco Editor integration as the next step.